name: Update Events Data from Markdown

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ9ç‚¹è¿è¡Œ
    - cron: '0 1 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    # å½“aisafetystudy-docä»“åº“æœ‰æ–°çš„Markdownæ–‡ä»¶æ—¶è§¦å‘
    paths:
      - 'talk-*.md'
      - 'seminars/*.md'
      - 'lectures/*.md'
      - 'courses/*.md'

jobs:
  update-events:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout main repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Test Markdown parsing
      run: |
        echo "ğŸ§ª æµ‹è¯•Markdownè§£æåŠŸèƒ½..."
        node scripts/test-markdown-parser.js
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Update events cache
      run: |
        echo "ğŸ”„ æ›´æ–°äº‹ä»¶ç¼“å­˜..."
        curl -X POST http://localhost:3000/api/events || echo "API endpoint not available"
      continue-on-error: true
    
    - name: Notify on success
      if: success()
      run: |
        echo "âœ… Events data updated successfully from Markdown files"
    
    - name: Notify on failure
      if: failure()
      run: |
        echo "âŒ Failed to update events data"
        exit 1
